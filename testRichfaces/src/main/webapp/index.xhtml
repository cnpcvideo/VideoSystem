<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="/resources/scaffold/forge-template.xhtml">

	<ui:param name="pageTitle" value="Welcome to Seam Forge" />
	
	<ui:define name="header">
		Welcome to Forge
	</ui:define>

	<ui:define name="subheader">
		Your application is running.
	</ui:define>

	<ui:define name="main">
		<a4j:status onstart="#{rich:component('statPane')}.show()"
        	onstop="#{rich:component('statPane')}.hide()" />    
      <h:form id="form">
		<rich:dataTable value="#{studentFaces.students}" var="student"
			iterationStatusVar="it" id="student_table" rows="5">
			<rich:column>
				<f:facet name="header">#</f:facet>
				#{it.index}
			</rich:column>
			<rich:column>
				<f:facet name="header">ID</f:facet>
				<h:outputText value="#{student.id}" />
			</rich:column>
			<rich:column>
				<f:facet name="header">Name</f:facet>
				<h:outputText value="#{student.name}" />
			</rich:column>
			<rich:column>
				<f:facet name="header">Gender</f:facet>
				<h:outputText value="#{student.gender}" />
			</rich:column>
			<rich:column>
				<f:facet name="header">Age</f:facet>
				<h:outputText value="#{student.age}" />
			</rich:column>
			<rich:column>
				<a4j:commandLink styleClass="no-decor" execute="@this"
					render="@none" 
					oncomplete="#{rich:component('confirmPane')}.show()">
					<h:graphicImage value="/images/delete.gif" />
					<f:setPropertyActionListener target="#{studentFaces.editedStudent}"
							value="#{student}" />
				</a4j:commandLink>
				<a4j:commandLink styleClass="no-decor" execute="@this"
					render="editGrid" 
					oncomplete="#{rich:component('editPane')}.show()">
					<h:graphicImage value="/images/edit.gif" />\
					<f:setPropertyActionListener target="#{studentFaces.editedStudent}"
							value="#{student}" />
				</a4j:commandLink>
			</rich:column>
			<f:facet name="footer">
				<rich:dataScroller page="#{studentFaces.page}" />
			</f:facet>
		</rich:dataTable>
		
		<rich:panel>
				<a4j:commandLink styleClass="no-decor" execute="@this"
					render="@none" value="add new student"
					oncomplete="#{rich:component('addPane')}.show()">
				</a4j:commandLink>
		</rich:panel>
		
		<a4j:jsFunction name="remove" action="#{studentFaces.remove}"
				render="student_table" execute="@this"
				oncomplete="#{rich:component('confirmPane')}.hide()"/>
				
		<rich:popupPanel id="statPane" autosized="true">
			<h:graphicImage value="/images/ai.gif" />
			Please wait...
		</rich:popupPanel>
		
		<rich:popupPanel header="Add New Student" id="addPane"
			domElementAttachment="parent" width="400" height="170">
			<h:panelGrid columns="3" id="AddGrid">
				<h:outputText value="StudentID" />
				<h:inputText value="#{studentFaces.newStudent.id}"
					required = "true"
					requiredMessage="ID is Required" id="new_id"/>
				<h:panelGroup/>
				
				<h:outputText value="StudentName" />
				<h:inputText value="#{studentFaces.newStudent.name}"
					required = "true"
					requiredMessage="Name is Required" id="new_name"/>
				<h:panelGroup/>
				
				<h:outputText value="StudentGender" />
				<h:inputText value="#{studentFaces.newStudent.gender}"
					required = "true"
					requiredMessage="Gender is Required" id="new_gender"/>
				<h:panelGroup/>
				
				<h:outputText value="StudentAge" />
				<h:inputText value="#{studentFaces.newStudent.age}"
					required = "true"
					requiredMessage="Age is Required" id="new_age"/>
				<h:panelGroup/>
			</h:panelGrid>
			
			<a4j:commandButton value="Add" action="#{studentFaces.create}"
					render="student_table" execute="addPane" 
					oncomplete="if(#{facesContext.maximumSeverity==null}){#{rich:component('addPane')}.hide();}">
			</a4j:commandButton>
			<a4j:commandButton value="Cancel"
					onclick="#{rich:component('addPane')}.hide(); return false;" />
		</rich:popupPanel>
		
		<rich:popupPanel id="confirmPane" autosized="true">
			Are you sure you want to delete the row?
			<a4j:commandButton value="Cancel"
				onclick="#{rich:component('confirmPane')}.hide();return false;" />
			<a4j:commandButton value="Delete" 
				onclick="remove(); return false;" />
		</rich:popupPanel>
		
		<rich:popupPanel header="Edit Student Details" id="editPane"
			domElementAttachment="parent" width="400" height="170">
			<h:panelGrid columns="3" id="editGrid">
				<h:outputText value="StudentID" />
				<h:outputText value="#{studentFaces.editedStudent.id}" />
				<h:panelGroup/>
				
				<h:outputText value="StudentName" />
				<h:inputText value="#{studentFaces.editedStudent.name}"
					required = "true"
					requiredMessage="Name is Required" id="student_name"
					label="Name Field">
				</h:inputText>
				<rich:message id="nameMsg" for="student_name" />
				
				<h:outputText value="StudentGender" />
				<h:inputText value="#{studentFaces.editedStudent.gender}"
					required = "true"
					requiredMessage="Gender is Required" id="student_gender"
					label="Gender Field">
				</h:inputText>
				<rich:message id="genderMsg" for="student_gender" />
				
				<h:outputText value="StudentAge" />
				<h:inputText value="#{studentFaces.editedStudent.age}"
					required = "true"
					requiredMessage="Age is Required" id="student_age"
					converterMessage="should be a valid age"
					validatorMessage="Should be a valid age"
					label="Age Field">
					<f:validateDoubleRange/>
				</h:inputText>
				<rich:message id="ageMsg" for="student_age" />
			</h:panelGrid>
			
			<a4j:commandButton value="Update" action="#{studentFaces.update}"
					render="student_table" execute="editPane" 
					oncomplete="if(#{facesContext.maximumSeverity==null}){#{rich:component('editPane')}.hide();}">
			</a4j:commandButton>
			<a4j:commandButton value="Cancel"
					onclick="#{rich:component('editPane')}.hide(); return false;" />
		</rich:popupPanel>
		</h:form>
	</ui:define>

	<ui:define name="footer">
      <p class="logos">
      	<a target="_blank" href="http://jboss.org"><img src="#{resource['jboss-community.png']}" alt="JBoss and JBoss Community" width="254" height="31" border="0"/></a>
      </p>
      <p class="note">To replace this page, edit 'src/main/webapp/index.xhtml', or keep Forging!</p>
	</ui:define>

</ui:composition>
</html>

